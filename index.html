<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Screen Recorder Lite</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #00ffff, #8e24aa);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 30px;
    color: white;
    margin: 0;
}

.controls, #floatingToolbox {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
}

select, button, label {
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    background: rgba(0,0,0,0.5);
    color: white;
    font-size: 13px;
    cursor: pointer;
}

select:hover, button:hover, label:hover { background: rgba(0,0,0,0.7); }

#timer { font-size: 22px; margin-top: 10px; }

video { margin-top: 15px; max-width: 80%; border-radius: 8px; }

#floatingToolbox {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    padding: 6px;
    border-radius: 10px;
    gap: 5px;
    cursor: move;
    user-select: none;
    z-index: 9999;
}
#floatingToolbox button { padding: 4px 8px; font-size: 12px; background: rgba(255,255,255,0.1); }
#floatingToolbox button:hover { background: rgba(255,255,255,0.3); }
</style>
</head>
<body>
<h1>Ultimate Screen Recorder Lite</h1>

<div class="controls">
    <select id="resolution">
        <option value="1280x720">720p</option>
        <option value="1920x1080" selected>1080p</option>
        <option value="2560x1440">1440p</option>
        <option value="3840x2160">4K</option>
    </select>

    <select id="fps">
        <option value="30">30 FPS</option>
        <option value="60" selected>60 FPS</option>
    </select>

    <label><input type="checkbox" id="micCheckbox"> Mic On</label>
    <button id="start">Start</button>
</div>

<div id="timer">00:00:00</div>
<video id="preview" controls hidden></video>
<button id="downloadBtn" hidden>Download</button>

<div id="floatingToolbox" hidden>
    <button id="pauseBtn">‚è∏ Pause</button>
    <button id="resumeBtn" disabled>‚ñ∂ Resume</button>
    <button id="stopBtn">‚èπ Stop</button>
    <button id="micToggle">üé§ Mic</button>
</div>

<script>
let mediaRecorder, recordedChunks=[], timerInterval, seconds=0, stream, micStream, mixedStream, micEnabled=false;
const toolbox=document.getElementById('floatingToolbox'), pauseBtn=document.getElementById('pauseBtn'),
resumeBtn=document.getElementById('resumeBtn'), stopBtn=document.getElementById('stopBtn'), micToggle=document.getElementById('micToggle');

function updateTimer() {
    seconds++;
    const h=String(Math.floor(seconds/3600)).padStart(2,'0'),
          m=String(Math.floor((seconds%3600)/60)).padStart(2,'0'),
          s=String(seconds%60).padStart(2,'0');
    document.getElementById('timer').textContent=`${h}:${m}:${s}`;
}

async function getMic() {
    try { micStream = await navigator.mediaDevices.getUserMedia({audio:true}); micEnabled=true; }
    catch { micEnabled=false; }
}

document.getElementById('start').onclick=async()=>{
    const [w,h]=document.getElementById('resolution').value.split('x').map(Number);
    const fps=Number(document.getElementById('fps').value), useMic=document.getElementById('micCheckbox').checked;

    try{
        stream=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:w},height:{ideal:h},frameRate:{ideal:fps,max:fps}}, audio:true});
        if(useMic) await getMic();

        if(micEnabled){
            const ctx=new AudioContext(), dest=ctx.createMediaStreamDestination();
            ctx.createMediaStreamSource(stream).connect(dest);
            ctx.createMediaStreamSource(micStream).connect(dest);
            mixedStream=new MediaStream([...stream.getVideoTracks(), ...dest.stream.getAudioTracks()]);
        } else mixedStream=stream;

        mediaRecorder=new MediaRecorder(mixedStream,{mimeType:'video/webm;codecs=vp8,opus',videoBitsPerSecond:8000000});
        recordedChunks=[];

        mediaRecorder.ondataavailable=e=>{if(e.data.size>0) recordedChunks.push(e.data);}
        mediaRecorder.onstart=()=>{timerInterval=setInterval(updateTimer,1000); toolbox.hidden=false;}
        mediaRecorder.onstop=()=>{
            clearInterval(timerInterval); seconds=0; document.getElementById('timer').textContent='00:00:00';
            stream.getTracks().forEach(t=>t.stop());
            if(micStream) micStream.getTracks().forEach(t=>t.stop());
            toolbox.hidden=true; pauseBtn.disabled=false; resumeBtn.disabled=true;

            const blob=new Blob(recordedChunks,{type:'video/webm'}), url=URL.createObjectURL(blob);
            const preview=document.getElementById('preview');
            preview.src=url; preview.hidden=false; preview.play();
            const dl=document.getElementById('downloadBtn'); dl.hidden=false;
            dl.onclick=()=>{const a=document.createElement('a'); a.href=url; a.download='recording.webm'; a.click();}
        };

        mediaRecorder.start(100);
        document.getElementById('start').disabled=true;
    }catch(e){alert("Recording failed: "+e);}
};

pauseBtn.onclick=()=>{if(mediaRecorder.state==="recording"){mediaRecorder.pause(); pauseBtn.disabled=true; resumeBtn.disabled=false;}}
resumeBtn.onclick=()=>{if(mediaRecorder.state==="paused"){mediaRecorder.resume(); pauseBtn.disabled=false; resumeBtn.disabled=true;}}
stopBtn.onclick=()=>{if(mediaRecorder.state!=="inactive"){mediaRecorder.stop(); document.getElementById('start').disabled=false;}}

micToggle.onclick=async()=>{
    if(!micEnabled){await getMic(); if(micEnabled){alert("Mic ON");}} 
    else {micStream.getTracks().forEach(t=>t.stop()); micEnabled=false; alert("Mic OFF");}
};

// Draggable toolbox
(function(el){let dragging=false, offsetX, offsetY;
el.addEventListener('mousedown',e=>{dragging=true; offsetX=e.clientX-el.getBoundingClientRect().left; offsetY=e.clientY-el.getBoundingClientRect().top;});
document.addEventListener('mousemove',e=>{if(dragging){el.style.left=e.clientX-offsetX+'px'; el.style.top=e.clientY-offsetY+'px'; el.style.right='auto';}});
document.addEventListener('mouseup',()=>dragging=false);})(toolbox);
</script>
</body>
</html>
